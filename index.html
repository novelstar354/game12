<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>BINGO å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
    margin:0;
    background:#111;
    color:#fff;
    font-family:sans-serif;
    text-align:center;
}
h1 span{font-size:40px;color:#0ff;}
button{padding:10px 18px;font-size:16px;margin:6px;}
.hidden{display:none;}
#number{font-size:70px;margin:15px;animation:pop .4s;}
@keyframes pop{0%{transform:scale(.3)}100%{transform:scale(1)}}
.card{display:inline-block;margin:10px;}
table{border-collapse:collapse;margin:auto;}
td{width:45px;height:45px;border:2px solid #fff;font-size:18px;}
.hit{background:#0f0;color:#000;}
.free{background:orange;}
#drawnList{max-height:80px;overflow:auto;border:1px solid #555;padding:5px;}
canvas{position:fixed;left:0;top:0;pointer-events:none;}
input[type=range]{width:200px;}
</style>
</head>
<body>

<h1><span>B</span><span>I</span><span>N</span><span>G</span><span>O</span></h1>

<div id="start">
    <p>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°</p>
    <select id="playerCount">
        <option>1</option><option>2</option><option>3</option><option>4</option>
    </select><br><br>
    <button onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<div id="game" class="hidden">
    <div id="number">---</div>

    <button onclick="draw()">æŠ½é¸</button>
    <button onclick="toggleAuto()">è‡ªå‹•</button>
    <button onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>

    <p>ğŸ”Š éŸ³é‡</p>
    <input type="range" min="0" max="1" step="0.01" value="0.5" oninput="setVolume(this.value)">

    <div id="drawnList"></div>
    <div id="players"></div>
</div>

<canvas id="confetti"></canvas>

<audio id="se" src="https://cdn.pixabay.com/audio/2022/03/15/audio_7b0f2d1f27.mp3"></audio>
<audio id="bingoSe" src="https://cdn.pixabay.com/audio/2022/03/15/audio_75b04fa5e4.mp3"></audio>

<script>
let numbers=[], drawn=[], players=[], auto=false, timer;
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");
const se=document.getElementById("se");
const bingoSe=document.getElementById("bingoSe");

function setVolume(v){
    se.volume=v;
    bingoSe.volume=v;
}

function resize(){
    canvas.width=innerWidth;
    canvas.height=innerHeight;
}
window.onresize=resize;
resize();

function startGame(){
    document.getElementById("start").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");
    players=[];
    let c=Number(document.getElementById("playerCount").value);
    for(let i=0;i<c;i++) players.push(makeCard());
    initNumbers();
    renderPlayers();
}

function initNumbers(){
    numbers=[];
    for(let i=1;i<=75;i++) numbers.push(i);
}

function range(a,b){return [...Array(b-a+1)].map((_,i)=>a+i);}
function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}

function makeCard(){
    let B=range(1,15),I=range(16,30),N=range(31,45),G=range(46,60),O=range(61,75);
    [B,I,N,G,O].forEach(shuffle);
    return [...Array(5)].map((_,r)=>[
        B[r],I[r],r===2?"FREE":N[r],G[r],O[r]
    ]);
}

function renderPlayers(){
    const area=document.getElementById("players");
    area.innerHTML="";
    players.forEach((card,i)=>{
        let div=document.createElement("div");
        div.className="card";
        div.innerHTML=`<h3>P${i+1}</h3>`;
        let t=document.createElement("table");
        card.forEach(row=>{
            let tr=document.createElement("tr");
            row.forEach(v=>{
                let td=document.createElement("td");
                td.textContent=v;
                if(v==="FREE") td.classList.add("free");
                tr.appendChild(td);
            });
            t.appendChild(tr);
        });
        div.appendChild(t);
        area.appendChild(div);
    });
}

function draw(){
    if(numbers.length===0) return;
    let n=numbers.splice(Math.floor(Math.random()*numbers.length),1)[0];
    drawn.push(n);
    document.getElementById("number").textContent=n;
    se.currentTime=0;
    se.play();
    updateDrawn();
    mark(n);
    checkBingo();
}

function updateDrawn(){
    document.getElementById("drawnList").textContent=drawn.join(", ");
}

function mark(n){
    document.querySelectorAll("td").forEach(td=>{
        if(Number(td.textContent)===n) td.classList.add("hit");
    });
}

function checkBingo(){
    players.forEach((card,i)=>{
        let b=[...Array(5)].map(()=>Array(5).fill(false));
        for(let r=0;r<5;r++)for(let c=0;c<5;c++)
            b[r][c]=card[r][c]==="FREE"||drawn.includes(card[r][c]);
        for(let k=0;k<5;k++){
            if(b[k].every(v=>v)||b.map(r=>r[k]).every(v=>v)) win(i);
        }
        if([0,1,2,3,4].every(i=>b[i][i])) win(i);
        if([0,1,2,3,4].every(i=>b[i][4-i])) win(i);
    });
}

function win(i){
    bingoSe.currentTime=0;
    bingoSe.play();
    document.querySelectorAll(".card")[i].querySelector("h3").textContent="ğŸ‰ BINGO! ğŸ‰";
    confetti();
}

function toggleAuto(){
    auto=!auto;
    auto ? timer=setInterval(draw,1500) : clearInterval(timer);
}

function resetAll(){
    location.reload();
}

function confetti(){
    let p=[];
    for(let i=0;i<150;i++){
        p.push({
            x:Math.random()*canvas.width,
            y:-10,
            r:Math.random()*6+4,
            c:`hsl(${Math.random()*360},100%,50%)`,
            v:Math.random()*3+2
        });
    }
    let t=setInterval(()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        p.forEach(o=>{
            o.y+=o.v;
            ctx.fillStyle=o.c;
            ctx.beginPath();
            ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
            ctx.fill();
        });
    },30);
    setTimeout(()=>clearInterval(t),2000);
}
</script>
</body>
</html>
